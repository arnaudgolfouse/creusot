module M_use_tree
  use creusot.prelude.Any
  use creusot.int.UInt32
  
  type t_Node = { left: t_Tree; val': UInt32.t; right: t_Tree }
  with t_Option_Box_Node_Global = None | Some t_Node
  with t_Tree = { f0: t_Option_Box_Node_Global }
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec use_tree (_1: t_Tree) (return (x: ())) = (! bb0
    [ bb0 = return {_0} ] [ & _0: () = Any.any_l () ]) [ return (result: ()) -> (! return {result}) ]
end
module M_impl_Tree__height (* Tree *)
  use creusot.int.UInt32
  use creusot.int.UInt64
  use mach.int.Int
  use creusot.prelude.Any
  
  type t_Tree = { f0: t_Option_Box_Node_Global }
  with t_Node = { left: t_Tree; val': UInt32.t; right: t_Tree }
  with t_Option_Box_Node_Global = None | Some t_Node
  
  let rec elim_Some (input: t_Option_Box_Node_Global) (ret (f0'0: t_Node)) = any
    [ good (f0'0: t_Node) -> {Some f0'0 = input} (! ret {f0'0})
    | bad -> {forall f0'0: t_Node [Some f0'0: t_Option_Box_Node_Global]. Some f0'0 <> input} (! {false} any) ]
  
  function deep_model_u64 [@inline:trivial] (self: UInt64.t) : int = UInt64.t'int self
  
  meta "rewrite_def" function deep_model_u64
  
  let rec max_u64 (self_: UInt64.t) (o: UInt64.t) (return (x: UInt64.t)) = any
    [ return (result: UInt64.t) -> {deep_model_u64 result >= deep_model_u64 self_}
      {deep_model_u64 result >= deep_model_u64 o}
      {result = self_ \/ result = o}
      {deep_model_u64 self_ <= deep_model_u64 o -> result = o}
      {deep_model_u64 o < deep_model_u64 self_ -> result = self_}
      (! return {result}) ]
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec height (self: t_Tree) (return (x: UInt64.t)) = (! bb0
    [ bb0 = any [ br0 -> {self.f0 = None} (! bb4) | br1 (x0: t_Node) -> {self.f0 = Some x0} (! bb3) ]
    | bb3 = s0
      [ s0 = elim_Some {self.f0} (fun (r0: t_Node) -> [ &n <- r0 ] s1)
      | s1 = height {n.left} (fun (_ret: UInt64.t) -> [ &_5 <- _ret ] s2)
      | s2 = bb5 ]
    | bb5 = s0 [ s0 = height {n.right} (fun (_ret: UInt64.t) -> [ &_7 <- _ret ] s1) | s1 = bb6 ]
    | bb6 = s0 [ s0 = max_u64 {_5} {_7} (fun (_ret: UInt64.t) -> [ &_4 <- _ret ] s1) | s1 = bb7 ]
    | bb7 = s0 [ s0 = UInt64.add {_4} {(1: UInt64.t)} (fun (_ret: UInt64.t) -> [ &_0 <- _ret ] s1) | s1 = bb8 ]
    | bb4 = s0 [ s0 = [ &_0 <- (0: UInt64.t) ] s1 | s1 = bb8 ]
    | bb8 = return {_0} ]
    [ & _0: UInt64.t = Any.any_l ()
    | & self: t_Tree = self
    | & n: t_Node = Any.any_l ()
    | & _4: UInt64.t = Any.any_l ()
    | & _5: UInt64.t = Any.any_l ()
    | & _7: UInt64.t = Any.any_l () ]) [ return (result: UInt64.t) -> (! return {result}) ]
end
