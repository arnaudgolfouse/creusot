module M_borrow_in_box
  use creusot.prelude.MutBorrow
  use creusot.int.Int32
  use creusot.prelude.Any
  
  predicate resolve_ref_i32 [@inline:trivial] (_1: MutBorrow.t Int32.t) = _1.final = _1.current
  
  meta "rewrite_def" predicate resolve_ref_i32
  
  predicate resolve_Box_ref_i32_Global [@inline:trivial] (_1: MutBorrow.t Int32.t) = resolve_ref_i32 _1
  
  meta "rewrite_def" predicate resolve_Box_ref_i32_Global
  
  meta "compute_max_steps" 1000000
  
  meta "select_lsinst" "all"
  
  let rec borrow_in_box (x: MutBorrow.t Int32.t) (return (x'0: MutBorrow.t Int32.t)) = (! bb0
    [ bb0 = s0
      [ s0 = MutBorrow.borrow_final <Int32.t> {x.current} {MutBorrow.get_id x}
          (fun (_ret: MutBorrow.t Int32.t) -> [ &_4 <- _ret ] [ &x <- { x with current = _ret.final } ] s1)
      | s1 = MutBorrow.borrow_final <Int32.t> {_4.current} {MutBorrow.get_id _4}
          (fun (_ret: MutBorrow.t Int32.t) -> [ &_2 <- _ret ] [ &_4 <- { _4 with current = _ret.final } ] s2)
      | s2 = -{resolve_ref_i32 _4}- s3
      | s3 = MutBorrow.borrow_final <Int32.t> {_2.current} {MutBorrow.get_id _2}
          (fun (_ret: MutBorrow.t Int32.t) -> [ &_0 <- _ret ] [ &_2 <- { _2 with current = _ret.final } ] s4)
      | s4 = -{resolve_ref_i32 _2}- s5
      | s5 = -{resolve_Box_ref_i32_Global x}- s6
      | s6 = bb1 ]
    | bb1 = return {_0} ]
    [ & _0: MutBorrow.t Int32.t = Any.any_l ()
    | & x: MutBorrow.t Int32.t = x
    | & _2: MutBorrow.t Int32.t = Any.any_l ()
    | & _4: MutBorrow.t Int32.t = Any.any_l () ])
    [ return (result: MutBorrow.t Int32.t) -> {[@expl:borrow_in_box ensures] result = x} (! return {result}) ]
end
